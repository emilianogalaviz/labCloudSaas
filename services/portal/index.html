<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>LabCloud - Portal MÃ©dico</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding-top: 50px; }
        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 400px; text-align: center; }
        
        /* Estilos del Login */
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #0066cc; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; }
        button:hover { background: #0052a3; }
        
        /* Estilos del Dashboard */
        .dashboard { width: 800px; text-align: left; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; margin-bottom: 20px; }
        .tenant-badge { background: #e6f3ff; color: #0066cc; padding: 5px 10px; border-radius: 15px; font-size: 14px; font-weight: bold; border: 1px solid #b3d9ff; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8f9fa; text-align: left; padding: 12px; border-bottom: 2px solid #ddd; color: #555; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f9f9f9; }
        
        .status-ok { color: green; font-weight: bold; }
        .hidden { display: none; }
        .error { color: red; margin-top: 10px; }
    </style>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1001.0.min.js"></script>
    <script src="https://rawgit.com/aws/amazon-cognito-identity-js/master/dist/amazon-cognito-identity.min.js"></script>
</head>
<body>

    <div id="login-view" class="container">
        <h2 style="color:#333;">LabCloud SaaS</h2>
        <p style="color:#666; margin-bottom: 20px;">Acceso Seguro a Laboratorios</p>
        <input type="email" id="email" placeholder="Correo (ej: admin@automatas.com)">
        <input type="password" id="password" placeholder="ContraseÃ±a">
        <button onclick="login()">Ingresar</button>
        <p id="message" class="error"></p>
    </div>

    <div id="dashboard-view" class="container dashboard hidden">
        <div class="header">
            <div>
                <h2 style="margin:0;">Resultados MÃ©dicos</h2>
                <p style="margin:5px 0 0 0; color:#666;" id="user-display">Usuario...</p>
            </div>
            <div style="text-align: right;">
                <span class="tenant-badge" id="tenant-display">Cargando Tenant...</span>
                <br>
                <button onclick="logout()" style="background:none; color:#666; width:auto; padding:5px; margin-top:10px; font-size:12px;">Cerrar SesiÃ³n</button>
            </div>
        </div>

        <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; border: 1px solid #c8e6c9; margin-bottom: 20px;">
            <strong>ðŸ”’ ConexiÃ³n Segura:</strong> EstÃ¡s conectado al esquema aislado de base de datos: <code id="db-schema" style="font-weight:bold;">...</code>
        </div>

        <table>
            <thead>
                <tr>
                    <th>ID Paciente</th>
                    <th>Prueba</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Resultado</th>
                </tr>
            </thead>
            <tbody id="patient-table">
                <tr>
                    <td>P-1024</td>
                    <td>Hemograma Completo</td>
                    <td>2023-11-28</td>
                    <td class="status-ok">Procesado</td>
                    <td><a href="#">Ver PDF</a></td>
                </tr>
                <tr>
                    <td>P-1025</td>
                    <td>Glucosa en Ayunas</td>
                    <td>2023-11-28</td>
                    <td class="status-ok">Procesado</td>
                    <td><a href="#">Ver PDF</a></td>
                </tr>
                <tr>
                    <td>P-1026</td>
                    <td>Perfil LipÃ­dico</td>
                    <td>2023-11-27</td>
                    <td style="color:orange">En Proceso</td>
                    <td>-</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // ==========================================
        // CONFIGURACIÃ“N
        // ==========================================
        const poolData = {
            UserPoolId: 'us-east-2_MtxCxYovb', 
            ClientId: '2helbqvf2cl0fitme2sh7t2ugl' 
        };

        var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

        function login() {
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;
            var authData = { Username: email, Password: password };
            var authDetails = new AmazonCognitoIdentity.AuthenticationDetails(authData);
            
            var userData = { Username: email, Pool: userPool };
            var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

            document.getElementById('message').innerText = "Autenticando...";

            cognitoUser.authenticateUser(authDetails, {
                onSuccess: function(result) {
                    var payload = result.getIdToken().payload;
                    var tenantId = payload['custom:tenant_id'];
                    var email = payload['email'];
                    mostrarDashboard(email, tenantId);
                },
                onFailure: function(err) {
                    document.getElementById('message').innerText = "Error: " + (err.message || JSON.stringify(err));
                },
            });
        }

        function mostrarDashboard(email, tenantId) {
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('dashboard-view').classList.remove('hidden');
            
            document.getElementById('user-display').innerText = email;
            document.getElementById('tenant-display').innerText = "Tenant: " + tenantId;
            document.getElementById('db-schema').innerText = tenantId;
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
</html>